# Intuitive split keys (prefix + | or _)
bind | split-window -h -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Easy pane navigation with Alt+hjkl (no prefix needed)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Resize panes with prefix + H/J/K/L (Shift+hjkl, repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Easy window navigation with Alt+np (no prefix needed)
bind -n M-p previous-window
bind -n M-n next-window

# Reload config with prefix + r
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# Kill session with prefix + Q
bind Q kill-session

# Kill pane without confirmation with prefix + X (capital X)
bind X kill-pane

# Create new window with prefix + w (overrides default choose-tree, which I don't use)
bind w new-window -c "#{pane_current_path}"

# Kill window without confirmation with prefix + W (capital W)
bind W kill-window

# Project switcher — fzf in a floating popup
bind -n M-f display-popup -E -w 40% -h 40% "~/.config/scripts/tmux-session-switcher.sh"

# Active sessions picker
bind -n M-s display-popup -E -w 40% -h 40% "~/.config/scripts/tmux-session-switcher.sh sessions"

# Toggle between last two sessions
bind -n M-` switch-client -l

# Jump to session by sorted position (Alt+1–9)
run 'for i in 1 2 3 4 5 6 7 8 9; do tmux bind -n M-$i run "~/.config/scripts/tmux-session-switcher.sh go $i"; done'

# Nested tmux passthrough (prefix + a to enter, F12 to exit)
# Disables outer prefix + root bindings so ALL keys reach inner tmux over SSH
bind a \
  set prefix None \; \
  set key-table off \; \
  set status-left "#[fg=#15161e,bg=#e0af68,bold]  PASS #[fg=#e0af68,bg=#000000,nobold] #[fg=#565f89] C-e to exit #[fg=#15161e,bg=#7aa2f7,bold]  #S #[fg=#7aa2f7,bg=#000000,nobold] " \; \
  refresh-client -S

# Ctrl+e exits passthrough mode (the only key captured while passthrough is active)
bind -T off C-e \
  set -u prefix \; \
  set -u key-table \; \
  set status-left "#[fg=#15161e,bg=#{?client_prefix,#394b70,#7aa2f7},bold]  #S #[fg=#{?client_prefix,#394b70,#7aa2f7},bg=#000000,nobold] " \; \
  refresh-client -S

# Enable mouse support
set -g mouse on

# Vi-style copy mode
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Switch to another session instead of detaching when a session is killed
set -g detach-on-destroy off

# Auto-rename windows based on current process
setw -g automatic-rename on
# Fill gaps in window numbering when a window is closed
set -g renumber-windows on

# Start window/pane numbering at 1 (easier to reach than 0)
set -g base-index 1
setw -g pane-base-index 1

# Faster escape time (better for vim users)
set -sg escape-time 10

# Increase history
set -g history-limit 10000

# Focus events on
set -g focus-events on

# ----- Tokyo Night (from tokyonight.nvim extras) -----
source-file ~/.local/share/nvim/lazy/tokyonight.nvim/extras/tmux/tokyonight_night.tmux

# Override status bar with custom minimal layout (extras includes date/time/hostname)
set -g status-style "fg=#7aa2f7,bg=#000000"
set -g status-position top
set -g status-left "#[fg=#15161e,bg=#{?client_prefix,#394b70,#7aa2f7},bold]  #S #[fg=#{?client_prefix,#394b70,#7aa2f7},bg=#000000,nobold] "
set -g status-left-length 60
set -g status-right "#(~/.config/scripts/tmux-session-switcher.sh status '#{session_name}')"
set -g status-right-length 80
set -g status-interval 5

# Custom window list (magenta active window)
set -g window-status-format "#[fg=#565f89] #I #W "
set -g window-status-current-format "#[fg=#1a1b26,bg=#bb9af7,bold] #I #W#{?window_zoomed_flag, 󰊓,} #[fg=#bb9af7,bg=#000000,nobold]"
set -g window-status-separator ""

# Toggle status bar
bind b set -g status

# Heavy pane borders + inactive dimming (extras doesn't set these)
set -g pane-border-lines heavy
set -g pane-active-border-style "fg=#bb9af7"
set -g window-style "fg=#565f89"
set -g window-active-style "fg=#a9b1d6"
