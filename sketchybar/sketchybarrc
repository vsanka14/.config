#!/bin/bash

# Colors (Tokyo Night Moon)
export BAR_COLOR=0xcc0d0f18           # ~0.80 opacity, matching wezterm
export ITEM_BG_COLOR=0xee2a2f45       # Moon darker, enhanced visibility
export CONTAINER_BG_COLOR=0x991e2030   # Moon bg_dark, ~0.60 opacity
export ACCENT_BLUE=0xff82aaff         # Blue
export ACCENT_PURPLE=0xffc099ff       # Purple
export ACCENT_CYAN=0xff86e1fc         # Cyan
export ACCENT_GREEN=0xffc3e88d        # Green
export ACCENT_PINK=0xfffca7ea         # Magenta/Pink
export ACCENT_ORANGE=0xffffc777       # Yellow/Orange
export ACCENT_RED=0xffff757f          # Red
export FG_COLOR=0xffc8d3f5            # Moon foreground
export FG_MUTED=0xff636da6            # Moon muted

# Font
FONT="JetBrainsMono Nerd Font"

# Bar appearance
sketchybar --bar \
    height=32 \
    blur_radius=30 \
    position=top \
    sticky=on \
    padding_left=8 \
    padding_right=8 \
    color=$BAR_COLOR \
    shadow=off

# Default item settings
sketchybar --default \
    icon.font="$FONT:Bold:16.0" \
    icon.color=$FG_COLOR \
    label.font="$FONT:Medium:12.0" \
    label.color=$FG_COLOR \
    padding_left=4 \
    padding_right=4

# Aerospace workspace event
sketchybar --add event aerospace_workspace_change

# Workspace icons (Nerd Font)
declare -A SPACE_ICONS=(
    [1]="󰖟"   # browser
    [2]="󰆍"   # terminal/dev
    [3]="󰒱"   # slack
    [4]="󰴢"   # teams
    [5]="󰮫"   # misc
)

# Workspace indicators (left side)
for sid in 1 2 3 4 5; do
    sketchybar --add item space.$sid left \
        --set space.$sid \
            icon="${SPACE_ICONS[$sid]}" \
            icon.padding_left=8 \
            icon.padding_right=8 \
            background.color=$ITEM_BG_COLOR \
            background.corner_radius=4 \
            background.height=20 \
            background.drawing=off \
            label.drawing=off \
            script="$CONFIG_DIR/plugins/aerospace.sh" \
        --subscribe space.$sid aerospace_workspace_change
done

# Battery (right side)
sketchybar --add item battery right \
    --set battery \
        update_freq=120 \
        icon.padding_right=6 \
        icon.color=$ACCENT_ORANGE \
        script="$CONFIG_DIR/plugins/battery.sh" \
    --subscribe battery system_woke power_source_change

# Battery container
sketchybar --add bracket battery_container battery \
    --set battery_container \
        background.color=$CONTAINER_BG_COLOR \
        background.corner_radius=6 \
        background.height=24 \
        background.drawing=on

# Spacer between containers
sketchybar --add item spacer right \
    --set spacer \
        width=8 \
        background.drawing=off \
        icon.drawing=off \
        label.drawing=off

# Clock (right side)
sketchybar --add item clock right \
    --set clock \
        update_freq=10 \
        icon.padding_right=6 \
        icon.color=$ACCENT_PURPLE \
        script="$CONFIG_DIR/plugins/clock.sh"

# Clock container
sketchybar --add bracket clock_container clock \
    --set clock_container \
        background.color=$CONTAINER_BG_COLOR \
        background.corner_radius=6 \
        background.height=24 \
        background.drawing=on

# Force initial update
sketchybar --update
